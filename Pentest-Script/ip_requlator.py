#Written by Ramazan Emre Erkan. 30/06/2019
import time
import os
import re
from collections import OrderedDict

os.system("netdiscover -P -N > netdiscover_output.txt")
#counter = time.time()
#sleep(20)
#try:
#	if(counter ==20):
#		os.system("killall netdiscover")
#except:
#	print("hata")
#	os._exit(0)

os.system("cat netdiscover_output.txt | sort -r | uniq --group | awk '{print $1}'>Ip.txt")
IpRead = open("Ip.txt","r")
IrregularIp = IpRead.read() 
IpRead.close()
os.remove("Ip.txt")
CleanIpList = []
for i in IrregularIp.splitlines():
	i =re.findall(r'(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})',IrregularIp)
	CleanIpList = list(OrderedDict.fromkeys(i))

os.system("cat > cleanIp.txt")

IpList = open("cleanIp.txt", "r+")
for temp in CleanIpList:
	print(temp)
	IpList.write("%s\n"%temp)


for nmapIp in CleanIpList:
	query1 = "nmap -T5 -sC -sV -A -oX "+path+str(nmapIp)+".xml "+path+str(nmapIp)
	print(query1)
	os.system(query1)
	time.sleep(60)
	print(nmapIp, " is scanned")

for result in CleanIpList:
	query2 = "xsltproc "+path+str(result)+".xml -o "+path+str(result)+".html"
	os.system(query2)	
	time.sleep(60)
	print(result,".html is created")
